<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Debugging in ES6 | System 2</title>

    <style>body{font-family:helvetica neue,Arial;margin:40px auto;max-width:650px;line-height:1.6;font-size:18px;color:#444;padding:0 10px}blockquote{font-style:italic}h1,h2,h3{line-height:1.2}.header-menu{float:right}ul.pagination{list-style-type:none;text-align:center;padding:0}ul.pagination>li{padding:0 8px;display:inline-block}div.footer{padding-top:10px;text-align:center}</style>

    
</head>

  <body>
<div class="header">
  <a href="/">/</a>
  <div class="header-menu">
    <a href="/post/">blog</a>
    <a href="/about/">about</a>
  </div>
</div>

<div id="content">

<header>
  <h1>Debugging in ES6</h1>
  <hr/>
  

<div class="post-meta">
    Date: <time datetime="2016-07-01">2016-07-01</time><br/>
    
    Tags:
    <a href="http://system2.io/tags/javascript/">javascript</a>
    <a href="http://system2.io/tags/node/">node</a>
    <a href="http://system2.io/tags/debug/">debug</a>
</div>

</header>
<article>
  

<p>In the advent of ES6 and transpilers, writing clean and concise javascript has never been so easy and kind on the soul. However, using a compiler presents some challenges when it comes to debugging, namely in relation to mapping the source code to the compiled output. Fortunately, this isn&rsquo;t a new problem and has been solved for plenty of other compilers. In this post, we&rsquo;ll focus on javascript&rsquo;s most popular compiler, <a href="http://babel.org">babel</a> and the tools to use to enable this.</p>

<h3 id="why-use-babel">Why use babel?</h3>

<p>Node 6 is pretty <a href="http://node.green/">close</a> to implementing all of ES6 proposed features, but in the current state of things we are missing one important feature; <em>modules</em>. If you&rsquo;d prefer to use CommonJS modules instead of ES6 modules, then you will probably get away with just using native javascript and using <code>node debug main.js</code>. However, if you&rsquo;d prefer to use babel and take advantage of es6 features, then read on.</p>

<h3 id="setting-up-babel">Setting up babel</h3>

<p>Installing babel is dead simple, let&rsquo;s get started with an example project:</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="">#</span> <span style="">package.json</span>
{
  &#34;name&#34;: <span style="color:#a31515">&#34;es6-debug-sample&#34;</span>,
  &#34;version&#34;: <span style="color:#a31515">&#34;1.0.0&#34;</span>,
  &#34;description&#34;: <span style="color:#a31515">&#34;&#34;</span>,
  &#34;main&#34;: <span style="color:#a31515">&#34;src/index.js&#34;</span>,
  &#34;scripts&#34;: {
    &#34;build&#34;: <span style="color:#a31515">&#34;babel --presets es2015 src -d dist&#34;</span>
  },
  &#34;devDependencies&#34;: {
    &#34;babel-cli&#34;: <span style="color:#a31515">&#34;^6.9.0&#34;</span>,
    &#34;babel-preset-es2015&#34;: <span style="color:#a31515">&#34;^6.5.0&#34;</span>
  }
}</code></pre></td></tr></table>
</div>
</div>
<p>Next, we&rsquo;re going to create basic file in <code>src/index.js</code>:</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#00f">import</span> foo from <span style="color:#a31515">&#39;./foo&#39;</span>

foo(<span style="color:#a31515">&#39;hello world&#39;</span>);
</code></pre></td></tr></table>
</div>
</div>
<p>and <code>src/foo.js</code></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#00f">export</span> <span style="color:#00f">default</span> <span style="color:#00f">function</span>(str) {
  <span style="color:#00f">debugger</span>; <span style="color:#008000">// this is going to breakpoint our debugger
</span><span style="color:#008000"></span>  console.log(str);
}
</code></pre></td></tr></table>
</div>
</div>
<p>Now let&rsquo;s run <code>npm run build</code>, we should see a new <code>dist</code> folder with the compiled output. For example <code>dist/index.js</code></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#008000">// ES5 compiled output
</span><span style="color:#008000"></span>
<span style="color:#a31515">&#39;use strict&#39;</span>;

<span style="color:#00f">var</span> _foo = require(<span style="color:#a31515">&#39;./foo&#39;</span>);

<span style="color:#00f">var</span> _foo2 = _interopRequireDefault(_foo);

<span style="color:#00f">function</span> _interopRequireDefault(obj) { <span style="color:#00f">return</span> obj &amp;&amp; obj.__esModule ? obj : { <span style="color:#00f">default</span>: obj }; }

(0, _foo2.<span style="color:#00f">default</span>)(<span style="color:#a31515">&#39;hello world&#39;</span>);
</code></pre></td></tr></table>
</div>
</div>
<p>Obviously, debugging this compiled output isn&rsquo;t the most readable. Let&rsquo;s see an example; if you run <code>node debug dist/index.js</code> you should get a debugger session like this:</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt; Debugger listening on port 5858
connecting to 127.0.0.1:5858 ... ok
break in dist/index.js:1
&gt; 1 &#39;use strict&#39;;
  2
  3 var _foo = require(&#39;./foo&#39;);
debug&gt; cont
break in dist/foo.js:8
  6
  7 exports.default = function (str) {
&gt; 8   debugger;
  9   console.log(str);
 10 };
debug&gt; next
break in dist/foo.js:9
  7 exports.default = function (str) {
  8   debugger;
&gt; 9   console.log(str);
 10 };
 11 });
debug&gt; next
&lt; hello world
break in dist/foo.js:10
  8   debugger;
  9   console.log(str);
&gt;10 };
 11 });</pre></td></tr></table>
</div>
</div>
<p>This isn&rsquo;t ideal and though semantically reflects our source code, we can do better!</p>

<h3 id="using-node-inspector">Using node inspector</h3>

<p><a href="https://github.com/node-inspector/node-inspector">Node Inspector</a> is a debugger interface for Node.js applications that basically uses Chrome dev tools to support the source mapping from <code>src</code> files to <code>dist</code> files. Node inspector does this by using source map files. First things first, install <code>node-inspector</code>:</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">$ npm install -g node-inspector</pre></td></tr></table>
</div>
</div>
<p>Next, we need to tell our compiler to output debugging information, in this case in the form of source maps.</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">$ npm run build -- --source-maps</pre></td></tr></table>
</div>
</div>
<p>Now that we have the source maps compiled, we need to fire up node inspector to begin debugging the source files:</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">$ node-debug dist/index.js</pre></td></tr></table>
</div>
</div>
<p>Your web browser should automatically fire up (make sure you have chrome installed) and begin stepping through the code. The debugger will automatically stop at the <code>debugger</code> statement, but you can also set breakpoints in the dev tools as well.</p>

<p><center><img width="600" height="400" layout="responsive" src="/images/es6-debug.png"></img></center></p>

<h3 id="summary">Summary</h3>

<p>That&rsquo;s it! Now you can write your code in es6 for both the server and browser and debug it with chrome dev tools.
Enjoy!</p>

</article>



    </div>
<div class="footer">
  
  
  <div class="footer-links">
    <a href="https://github.com/eastwood">GitHub</a>
    <a href="/post/index.xml">RSS</a>
    <a href="https://twitter.com/_eastwd">Twitter</a>
  </div>
  

  
  
  <div class="copyright">© 2019 — Clint Ryan</div>
  
</div>

</body>

</html>
